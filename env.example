## API
PORT=3000

## CORS (Producción)
# Lista de orígenes permitidos separados por coma. Ej:
# ALLOWED_ORIGINS="https://mi-dominio.com,https://admin.mi-dominio.com"
ALLOWED_ORIGINS=""

## Database (PostgreSQL)
# Connection pooling se configura automáticamente según NODE_ENV:
# - Desarrollo: connection_limit=5, pool_timeout=10
# - Producción: connection_limit=20, pool_timeout=20
# Puedes sobrescribir agregando parámetros a la URL:
# DATABASE_URL="postgresql://...?connection_limit=30&pool_timeout=20"
DATABASE_URL="postgresql://ce:ce_password@localhost:5432/comercial_electrica?schema=public"

## Auth
# En producción: JWT_ACCESS_SECRET y JWT_REFRESH_SECRET desde gestor de secretos. No loguear ni commitear.
# Si el throttle de login no se resetea tras 1 min (Too Many Requests), pon THROTTLE_LOGIN_DISABLED=true
# en el servidor y redepliega; luego puedes volver a quitarla.
# THROTTLE_LOGIN_DISABLED=false
JWT_ACCESS_SECRET="CHANGE_ME_access"
# Sesión: expira a las 18 h (64800 s). No definir = 18 h por defecto en la API.
JWT_ACCESS_TTL_SECONDS=64800
JWT_REFRESH_SECRET="CHANGE_ME_refresh"
JWT_REFRESH_TTL_SECONDS=1209600

## Dueño del sistema (solo al ejecutar prisma:seed)
# Si defines PLATFORM_ADMIN_EMAIL y PLATFORM_ADMIN_PASSWORD (mín. 8 caracteres), el seed:
# - Crea solo tu usuario (Panel proveedor). Sin empresas ni usuarios de prueba (todo vacío).
# Si no las defines, se crean usuarios de desarrollo: platform@proveedor.local y admin@negocio.local
# PLATFORM_ADMIN_EMAIL="tu-email@ejemplo.com"
# PLATFORM_ADMIN_PASSWORD="TuPasswordSeguro123!"
# Lista de correos que siempre se tratan como Panel proveedor (aunque tengan tenant asignado). Separados por comas.
# PLATFORM_ADMIN_EMAILS="jean.serratov@orion.com,otro@ejemplo.com"

## Restringir login a solo ciertos correos
# Si defines ALLOWED_LOGIN_EMAILS, solo esos correos podrán iniciar sesión (lista separada por comas).
# Si no la defines pero sí PLATFORM_ADMIN_EMAIL, solo ese correo podrá iniciar sesión.
# No definir ninguna = cualquier usuario de la BD puede intentar login.
# ALLOWED_LOGIN_EMAILS="admin@empresa.com,vendedor@empresa.com"

## Forgot password (email real)
# URL base del frontend para el enlace de restablecer contraseña (ej. https://app.ejemplo.com)
FRONTEND_URL="http://localhost:3001"
# SMTP para enviar correos (si no se configuran, en dev se devuelve el token en la respuesta)
# SMTP_HOST="smtp.ejemplo.com"
# SMTP_PORT=587
# SMTP_USER="noreply@ejemplo.com"
# SMTP_PASS="password"
# SMTP_FROM="Orion <noreply@ejemplo.com>"

## Redis (BullMQ y Cache)
REDIS_URL="redis://localhost:6379"
CACHE_TTL_SECONDS=300

## Observabilidad
# Si false, los endpoints GET /metrics y GET /metrics/prometheus responden 404
METRICS_ENABLED=true
# Umbral de porcentaje para alertas de límites de rate (default: 80)
# Cuando un tenant alcanza este porcentaje de su límite, se marca como "warning"
# METRICS_ALERT_THRESHOLD_PERCENT=80
# Habilitar alertas automáticas (Slack, Email, Webhook)
# ALERTS_ENABLED=false
# Si "json", los logs de la API se escriben como una línea JSON por evento (timestamp, level, context, message)
# LOG_FORMAT=json

## Monitoreo de Performance de Queries
# Habilitar monitoreo de queries lentas (default: false)
# QUERY_PERFORMANCE_MONITORING=false
# Umbral en milisegundos para considerar query lenta (default: 1000ms)
# SLOW_QUERY_THRESHOLD_MS=1000

## Alertas (Slack, Email, Webhook)
# Webhook de Slack para alertas (formato: https://hooks.slack.com/services/...)
# SLACK_WEBHOOK_URL=
# Email para recibir alertas críticas
# ALERT_EMAIL=
# Webhook externo para alertas (POST JSON)
# ALERT_WEBHOOK_URL=
# Secret opcional para autenticar webhook externo
# ALERT_WEBHOOK_SECRET=

## IA – Resumen del dashboard
# Clave de OpenAI para el "Resumen del día" en lenguaje natural (GET /reports/dashboard-summary).
# Si no se define, se muestra "Resumen automático" sin LLM. Obtén la clave en https://platform.openai.com/api-keys
OPENAI_API_KEY=

## Backups
BACKUP_DIR="./backups"
AUTO_BACKUP_ENABLED=false
MAX_BACKUPS_TO_KEEP=30
# Copia off-site opcional (S3). Si se define, tras cada backup exitoso se sube a S3.
# BACKUP_S3_BUCKET=mi-bucket-backups
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=

## Auditoría – Retención y Archivado (opcional)
# Días de retención en línea para eventos no fiscales (referencia para archivado/purga externa). Eventos fiscales/críticos: mínimo 5 años (normativa DIAN).
# AUDIT_RETENTION_DAYS=730
# Habilitar archivado automático (ejecuta el día 1 de cada mes)
# ARCHIVE_ENABLED=false
# Años de retención para ventas antes de archivado (default: 2 años)
# SALES_RETENTION_YEARS=2

## Validation Limits
MAX_INVENTORY_QTY=1000000
MIN_INVENTORY_QTY=0
MAX_CASH_AMOUNT=100000000
MIN_CASH_AMOUNT=0
MAX_OPENING_AMOUNT=50000000
MAX_ITEMS_PER_SALE=100
MAX_ITEMS_PER_QUOTE=100
MAX_QTY_PER_ITEM=10000

## Rate Limiting por Plan (opcional, sobrescribe defaults)
# Límites de requests por minuto según plan del tenant:
# THROTTLE_LIMIT_DEFAULT=100        # Sin plan o plan desconocido
# THROTTLE_LIMIT_BASIC=100          # Plan básico (slug contiene "basico" o "basic")
# THROTTLE_LIMIT_PRO=1000           # Plan pro (slug contiene "pro")
# THROTTLE_LIMIT_ENTERPRISE=5000    # Plan enterprise (slug contiene "enterprise")

## Storage (placeholder; for cloud use S3/Azure/GCS)
OBJECT_STORAGE_PROVIDER="local"
OBJECT_STORAGE_BASE_PATH="./storage"

## DIAN (placeholder values; do not commit real secrets)
# En producción: usar gestor de secretos (Render Secrets, AWS Secrets Manager, Vault). No loguear ni incluir en .env en el repo.
DIAN_ENV="HABILITACION"
DIAN_SOFTWARE_ID="CHANGE_ME"
DIAN_SOFTWARE_PIN="CHANGE_ME"
# Envío real: si DIAN_API_BASE_URL está definida (o DIAN_USE_DEFAULT_URL=true), se hace POST con sobre SOAP ReceiveInvoice.
# Si no, se simula respuesta (desarrollo). Habilitación: https://vpfe-hab.dian.gov.co  Producción: https://vpfe.dian.gov.co
# DIAN_API_BASE_URL="https://vpfe-hab.dian.gov.co"
# Usar URLs por defecto según DIAN_ENV (hab/prod) sin definir DIAN_API_BASE_URL
# DIAN_USE_DEFAULT_URL=true
# Envío con sobre SOAP (ReceiveInvoice + fileName + contentFile base64). false = POST XML directo (pruebas).
# DIAN_USE_SOAP=true
# Ruta del servicio (por defecto /WcfDianCustomerServices.svc)
# DIAN_SEND_PATH="/WcfDianCustomerServices.svc"
# Timeout y reintentos para el envío HTTP (opcional)
# DIAN_HTTP_TIMEOUT_MS=30000
# DIAN_HTTP_MAX_RETRIES=3
# DIAN_HTTP_RETRY_DELAY_MS=5000
# Consulta de estado (GetStatus). Por defecto usa la misma base que el envío + DIAN_QUERY_STATUS_PATH.
# DIAN_QUERY_STATUS_URL="https://vpfe-hab.dian.gov.co/WcfDianCustomerServices.svc"
# DIAN_QUERY_STATUS_PATH="/WcfDianCustomerServices.svc"
# Certificado de firma electrónica (.p12). Si no se configuran, el XML se envía sin firmar.
# Certificado .p12 de firma electrónica: ruta al archivo O contenido en base64 (para Render/servidores sin disco).
# DIAN_CERT_PATH="./certs/firma-electronic.p12"
# DIAN_CERT_BASE64="<contenido del .p12 en base64>"   # Alternativa: útil en Render, no subir a repo.
# DIAN_CERT_PASSWORD="password_del_certificado"
# Multi-tenant: clave para cifrar certificados por empresa en BD (32 bytes hex o base64). Obligatoria si se usa configuración DIAN por tenant.
# DIAN_CERT_ENCRYPTION_KEY="<32 bytes en hex (64 caracteres) o base64>"
# NIT y razón social del emisor (empresa). Van en el XML UBL; si no se definen, se usa DIAN_SOFTWARE_ID como NIT (puede causar 400).
# DIAN_ISSUER_NIT="900123456-7"
# DIAN_ISSUER_NAME="Mi Empresa S.A.S."
# Modo contingencia: no enviar a la DIAN; documentos quedan en DRAFT. Ver docs/CONTINGENCIA_DIAN.md
# DIAN_CONTINGENCY_MODE=false

## Billing – Stripe (suscripciones y portal de pago)
# Necesitas una cuenta en https://dashboard.stripe.com (modo prueba para desarrollo).
# En producción: inyectar desde gestor de secretos. No commitear valores reales.
# STRIPE_SECRET_KEY=sk_test_...
# STRIPE_WEBHOOK_SECRET=whsec_...   # Lo obtienes al crear un webhook en Stripe (endpoint POST /billing/stripe).

## Pagos – PayU (Colombia: PSE, Nequi, Daviplata, tarjetas)
# Cuenta en https://colombia.payu.com → Configuración técnica.
# Documentación: https://developers.payulatam.com/latam/es/docs/integrations/
# En producción: inyectar desde gestor de secretos. No commitear valores reales.
# PAYU_API_KEY=...          # API Key (panel PayU).
# PAYU_MERCHANT_ID=...      # ID del comercio (merchantId).
# PAYU_ACCOUNT_ID=...       # ID de cuenta Colombia (ej. 512321 para pruebas).
# PAYU_TEST=true            # true = sandbox, false = producción.
# PAYU_CONFIRMATION_URL=... # URL de confirmación (POST). Ej: https://tu-dominio.com/payu/webhook
